<html>
<head>
<meta charset="utf-8"> 
<script type="text/javascript" src="scripts/modelcontroller.js"></script>
<script type="text/javascript" src="scripts/domain.js"></script>
<script type="text/javascript" src="scripts/cluster.js"></script>
<script type="text/javascript" src="scripts/node.js"></script>
<script type="text/javascript" src="scripts/cache.js"></script>
<script type="text/javascript">
var dmrClient = new ModelControllerClient(window.location.protocol+"//"+window.location.hostname+":9990/management", "admin", "!qazxsw2");
var domain = new Domain(dmrClient);

function refreshDomain() {
   document.getElementById("out").value = "";
   domain.refresh(function(d) {
      
      var clusters = d.getClusters();
      for(var i=0; i<clusters.length; i++) {
         clusters[i].refresh(function(cluster) {
            var caches = cluster.getCaches();
            for(var j=0; j<caches.length; j++) {
               caches[j].refresh(function(cache) {
                  document.getElementById("out").value += cache.cluster.name + ">" +cache.name + " " + cache.data["cache-availability"]+"\n";
               });
            }
         });
      }
   });
}

</script>
</head>
<body>
    <form action="#">
        <textarea id="out" rows="10" cols="80" readonly="readonly"></textarea>
        <button onclick="refreshDomain()">Refresh domain</button>
    </form>
</body>
</html>
